!function(a){"use strict";var b=a.fabric||(a.fabric={});b.Image.filters.ColorMatrix=b.util.createClass(b.Image.filters.BaseFilter,{type:"ColorMatrixFilter",initialize:function(a){a=a||{},this.matrix=a.matrix||[1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,0,0,0,1,0],this.worker=a.worker||2},applyTo:function(a){var b,c=document.createElement("canvas"),d=c.getContext("2d"),e=this.worker,f=a.height/e,g=a.width*a.height*4,h=g/e,i=0,j=[],k=this.matrix;return c.width=a.width,c.height=a.height,d.drawImage(a,0,0),new Promise(function(g,l){for(var m=0;e>m;m++){Worker.create=function(a){var b=a.toString(),c=new Blob(["'use strict';\nself.onmessage ="+b],{type:"text/javascript"});return window.URL.createObjectURL(c)};var n=Worker.create(function(a){var b,c,d,e,f,g=a.data.data,h=g.data,i=a.data.matrix,j=a.data.length,k=a.data.index;for(b=0;j>b;b+=4)c=h[b],d=h[b+1],e=h[b+2],f=h[b+3],h[b]=c*i[0]+d*i[1]+e*i[2]+f*i[3]+i[4],h[b+1]=c*i[5]+d*i[6]+e*i[7]+f*i[8]+i[9],h[b+2]=c*i[10]+d*i[11]+e*i[12]+f*i[13]+i[14],h[b+3]=c*i[15]+d*i[16]+e*i[17]+f*i[18]+i[19];self.postMessage({result:g,index:k}),self.close()}),o=new Worker(n);o.onmessage=function(a){var b=a.data.result,h=a.data.index;console.info("web worker "+h+" had a save journey"),j.splice(h,0,{index:h,data:b,blocks:f*h}),i++,i===e&&(j.forEach(function(a){d.putImageData(a.data,0,a.blocks)}),g(c))},o.onerror=function(a){l(Error("one of the workers had an horrible accident\n"+a.message+" in line "+a.lineno)),this.terminate()},b=d.getImageData(0,f*m,a.width,f),o.postMessage({data:b,index:m,length:h,matrix:k})}})}}),b.Image.filters.ColorMatrix.fromObject=function(a){return new b.Image.filters.ColorMatrix(a)}}("undefined"!=typeof exports?exports:this);